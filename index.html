<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GNSS SpaceTime Dashboard • EKF Fusion</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIINfBIHUPz0M7mR1mZ9/3wPzSS6i8tD6U4=" 
          crossorigin=""/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" 
          integrity="sha512-Fo3rlrZj/k7ujTnHg4CfmjR7mQUFm94/Nfae/Y55JjNfX/YvD9eD+N6n7N2+3X5C6ZqT2C2F+V+h/lVj7T1/qA=" 
          crossorigin="anonymous" referrerpolicy="no-referrer" />
          
    <style>
        /* --- Configuration Générale --- */
        :root {
            --bg-light: #f4f7f6;
            --bg-dark: #121220;
            --panel-light: #ffffff;
            --panel-dark: #1e1e1e;
            --text-light: #333333;
            --text-dark: #f0f0f0;
            --accent-color: #2a7f5a;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: background-color 0.3s, color 0.3s;
            display: flex;
            min-height: 100vh;
        }

        .dark-mode {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }
        
        .dark-mode .dashboard-panel {
            background-color: var(--panel-dark);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        
        .dark-mode .dashboard-panel h2 {
            border-bottom: 1px solid #444;
        }

        .dark-mode .data-point span:last-child {
            color: #79a6d2; /* Couleur de donnée en mode sombre */
        }

        .dark-mode input[type="number"], .dark-mode select {
            background-color: #333;
            color: var(--text-dark);
            border: 1px solid #555;
        }

        /* --- Disposition --- */
        .dashboard-panel {
            width: 380px;
            background-color: var(--panel-light);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
        }

        #map {
            flex-grow: 1;
            min-height: 100vh;
            background-color: #ccc; 
        }

        /* --- Éléments de Données --- */
        h2 {
            color: var(--accent-color);
            font-size: 1.3em;
            margin-top: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .data-point {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.9em;
        }

        .data-point span:last-child {
            font-weight: bold;
            color: var(--accent-color);
        }

        hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 10px 0;
        }

        /* --- Contrôles et Inputs --- */
        .control-area {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .control-input-full {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
        }

        .control-input-full label {
            font-size: 0.8em;
            margin-bottom: 3px;
            font-weight: 500;
        }

        .control-input-full input[type="number"], .control-input-full select {
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .control-buttons button {
            width: 49%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        #toggle-gps-btn {
            background-color: var(--accent-color);
            color: white;
        }
        #emergency-stop-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .toggle-mode {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        
        .toggle-mode button {
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            padding: 8px 12px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 1.2em;
        }

        .dark-mode .toggle-mode button {
            background-color: rgba(30, 30, 30, 0.8);
            color: var(--text-dark);
        }
    </style>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20n6sB1yYjE8q4e8Hn4g64k3O/vI/bC+P8lK4RjY2K4=" 
            crossorigin=""></script>
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
    <script src="gnss-dashboard-full-V2.js" defer></script>
</head>
<body>

    <div class="dashboard-panel">
        
        <div class="toggle-mode">
            <button id="toggle-mode-btn"><i class="fas fa-adjust"></i></button>
        </div>

        <h1><i class="fas fa-satellite-dish"></i> GNSS SpaceTime Dashboard</h1>
        
        <div class="control-area">
            <div class="control-input-full">
                <label for="mass-input">Masse de l'Objet (kg)</label>
                <input type="number" id="mass-input" value="70.0" step="1" min="1">
            </div>
            <div class="control-input-full">
                <label for="cda-input">CdA (Coefficient de Traînée * Surface, m²)</label>
                <input type="number" id="cda-input" value="0.5" step="0.01" min="0.01">
            </div>
            <div class="control-input-full">
                <label for="celestial-body-select">Corps Céleste / Gravité</label>
                <select id="celestial-body-select">
                    <option value="EARTH">Terre (G=9.81)</option>
                    <option value="MOON">Lune (G=1.62)</option>
                    <option value="MARS">Mars (G=3.71)</option>
                    <option value="ROTATING">Station Spatiale (Artificielle)</option>
                </select>
            </div>
            <div class="control-input-full">
                <label for="env-select">Environnement GPS</label>
                <select id="env-select">
                    <option value="NORMAL">Normal</option>
                    <option value="FOREST">Forêt</option>
                    <option value="CONCRETE">Grotte/Tunnel</option>
                    <option value="METAL">Métal/Bâtiment</option>
                </select>
            </div>
            <div class="control-buttons">
                <button id="toggle-gps-btn">Démarrer GPS & EKF</button>
                <button id="emergency-stop-btn">Stop Urgence</button>
            </div>
        </div>

        <h2><i class="fas fa-clock"></i> Temps & Astronomie</h2>
        <div class="data-point"><span>Heure Locale (NTP)</span><span id="local-time">N/A</span></div>
        <div class="data-point"><span>Date</span><span id="date-display">N/A</span></div>
        <div class="data-point"><span>Temps Écoulé</span><span id="elapsed-time">0.00 s</span></div>
        <div class="data-point"><span>Heure Solaire Vraie (TST)</span><span id="tst">N/A</span></div>
        <div class="data-point"><span>Temps Sidéral Local Vrai</span><span id="tslv">N/A</span></div>
        <div class="data-point"><span>Heure Minecraft</span><span id="time-minecraft">00:00</span></div>
        <div class="data-point"><span>Phase Lunaire</span><span id="moon-phase-name">N/A</span></div>
        <div class="data-point"><span>Statut Solaire</span><span id="clock-status">N/A</span></div>

        <hr>

        <h2><i class="fas fa-location-arrow"></i> Position & Cinématique</h2>
        <div class="data-point"><span>Latitude (EKF)</span><span id="lat-display">N/A</span></div>
        <div class="data-point"><span>Longitude (EKF)</span><span id="lon-display">N/A</span></div>
        <div class="data-point"><span>Altitude (EKF)</span><span id="alt-display">N/A</span></div>
        <div class="data-point"><span>Altitude Géopotentielle</span><span id="geopotential-alt">N/A</span></div>
        <div class="data-point"><span>Incertitude Alt. (σ)</span><span id="alt-uncertainty">N/A</span></div>
        <div class="data-point"><span>Gravité Locale (G)</span><span id="gravity-local">N/A</span></div>

        <hr>

        <h2><i class="fas fa-tachometer-alt"></i> Vitesse & Dynamique</h2>
        <div class="data-point"><span>Vitesse Stable (EKF)</span><span id="speed-stable">0.00 m/s</span></div>
        <div class="data-point"><span>Vitesse Brute GPS</span><span id="speed-raw">0.00 m/s</span></div>
        <div class="data-point"><span>Vitesse Max</span><span id="speed-max">0.00 km/h</span></div>
        <div class="data-point"><span>Distance Totale</span><span id="distance-total-km">0.00 km</span></div>
        <div class="data-point"><span>Temps en Mouvement</span><span id="time-moving">0.00 s</span></div>
        <div class="data-point"><span>Accélération Longitudinale</span><span id="accel-long">0.00 m/s²</span></div>

        <hr>
        
        <h2><i class="fas fa-microchip"></i> IMU & Capteurs</h2>
        <div class="data-point"><span>Accélération (X)</span><span id="acc-x">0.00 m/s²</span></div>
        <div class="data-point"><span>Accélération (Y)</span><span id="acc-y">0.00 m/s²</span></div>
        <div class="data-point"><span>Accélération (Z)</span><span id="acc-z">0.00 m/s²</span></div>
        <div class="data-point"><span>Statut Capteur</span><span id="imu-status">Inactif</span></div>

        <hr>

        <h2><i class="fas fa-flask"></i> Météo & Chimie</h2>
        <div class="data-point"><span>Temp. Air</span><span id="temp-air-2">N/A</span></div>
        <div class="data-point"><span>Pression Atm.</span><span id="pressure-2">N/A</span></div>
        <div class="data-point"><span>Humidité Relative</span><span id="humidity-2">N/A</span></div>
        <div class="data-point"><span>Point de Rosée</span><span id="dew-point">N/A</span></div>
        <div class="data-point"><span>Densité de l'Air</span><span id="air-density">N/A</span></div>
        <div class="data-point"><span>Humidité Absolue</span><span id="abs-humidity-sim">N/A</span></div>
        <div class="data-point"><span>Temp. Thermomètre Mouillé</span><span id="wet-bulb-temp-sim">N/A</span></div>
        <div class="data-point"><span>Indice de Stabilité (CAPE)</span><span id="CAPE-sim">N/A</span></div>
        
        <hr>
        
        <h2><i class="fas fa-dna"></i> Bio-Physique (SVT)</h2>
        <div class="data-point"><span>Saturation O₂ Théo.</span><span id="O2-saturation-sim">N/A</span></div>
        <div class="data-point"><span>Photosynthèse Sim.</span><span id="photosynthesis-rate-sim">N/A</span></div>
        <div class="data-point"><span>Respiration Cell. Sim.</span><span id="respiration-rate-sim">N/A</span></div>
        <div class="data-point"><span>Irradiance Solaire</span><span id="solar-irradiance">N/A</span></div>

        <hr>

        <h2><i class="fas fa-rocket"></i> Physique Avancée & Fluides</h2>
        <div class="data-point"><span>Facteur de Lorentz ($\gamma$)</span><span id="lorentz-factor">1.0000</span></div>
        <div class="data-point"><span>Dilation Temporelle (Vit)</span><span id="time-dilation-speed">0.00 ns/j</span></div>
        <div class="data-point"><span>Dilation Temporelle (Grav)</span><span id="grav-dilation">0.00 ns/j</span></div>
        <div class="data-point"><span>Énergie Relativiste ($E$)</span><span id="energy-relativistic">N/A</span></div>
        <div class="data-point"><span>Énergie de Masse au Repos ($E_0$)</span><span id="energy-rest-mass">N/A</span></div>
        <div class="data-point"><span>Rayon de Schwarzschild ($R_s$)</span><span id="Rs-object">N/A</span></div>
        <div class="data-point"><span>Quantité de Mouvement</span><span id="momentum">N/A</span></div>
        <div class="data-point"><span>Force de Coriolis</span><span id="coriolis-force">N/A</span></div>
        <div class="data-point"><span>Nombre de Mach</span><span id="mach-number">0.0000</span></div>
        <div class="data-point"><span>Nombre de Reynolds</span><span id="reynolds-number">N/A</span></div>
        <div class="data-point"><span>Pression Dynamique ($q$)</span><span id="dynamic-pressure">0.00 Pa</span></div>
        <div class="data-point"><span>Force de Traînée</span><span id="drag-force">0.00 N</span></div>
        <div class="data-point"><span>Pression de Radiation</span><span id="radiation-pressure">N/A</span></div>

        <hr>

        <h2><i class="fas fa-brain"></i> Filtre EKF & Métrologie</h2>
        <div class="data-point"><span>Incertitude Vitesse (P)</span><span id="kalman-uncert">N/A</span></div>
        <div class="data-point"><span>Bruit Mesure Vitesse (R)</span><span id="speed-error-perc">N/A</span></div>
        <div class="data-point"><span>Bande Passante (Nyquist)</span><span id="nyquist-frequency">N/A</span></div>
        <div class="data-point"><span>Statut GPS</span><span id="gps-status-dr">Arrêté</span></div>
        <div class="data-point"><span>Précision GPS (Acc)</span><span id="map-status">N/A</span></div>

    </div>

    <div id="map"></div>
</body>
        </html>
