<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GNSS SpaceTime Dashboard ‚Ä¢ EKF Fusion Dynamique</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIINfBIHUPz0M7mR1mZ9/3wPzSS6i8tD6U4=" 
          crossorigin=""/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" 
          integrity="sha512-Fo3rlrZj/k7ujTnHg4CfmjR7mQUFm94/Nfae/Y55JjNfX/YvD9eD+N6n7N2+3X5C6ZqT2C2F+V+h/lVj7T1/qA=" 
          crossorigin="anonymous" referrerpolicy="no-referrer" />
          
    <style>
        /* =================================================================
           CSS D√âTAILL√â
           ================================================================= */
        :root {
            --bg-light: #f4f7f6;
            --bg-dark: #0d0d19;
            --panel-light: #ffffff;
            --panel-dark: #1e1e1e;
            --text-light: #333333;
            --text-dark: #eeeeee;
            --primary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: background-color 0.3s, color 0.3s;
            display: flex;
            min-height: 100vh;
        }

        /* --- Mode Sombre (Dark Mode) --- */
        body.dark-mode {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        body.dark-mode .panel {
            background-color: var(--panel-dark);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        body.dark-mode input[type="number"],
        body.dark-mode select {
            background-color: #333;
            border-color: #555;
            color: var(--text-dark);
        }

        /* --- Mode Rayons-X (X-Ray Mode) --- */
        body.x-ray-mode {
            filter: invert(100%) hue-rotate(180deg);
        }

        /* --- Structure de la Page --- */
        #left-panel, #right-panel {
            width: 300px;
            padding: 20px;
            overflow-y: auto;
        }
        
        #center-map {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background-color: var(--bg-light);
        }
        
        .panel {
            background-color: var(--panel-light);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        /* --- En-t√™tes et Titres --- */
        h1 {
            font-size: 1.8em;
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 1.2em;
            margin-top: 0;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(150, 150, 150, 0.2);
            font-weight: 600;
        }

        h2 i {
            margin-right: 8px;
            color: var(--primary);
        }

        /* --- Affichage des Donn√©es --- */
        .data-point {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 0.95em;
            border-bottom: 1px dashed rgba(150, 150, 150, 0.1);
        }

        .data-point span:first-child {
            font-weight: 400;
            color: var(--text-light);
        }

        .data-point span:last-child {
            font-weight: 600;
            color: var(--primary);
            text-align: right;
            max-width: 60%;
        }

        body.dark-mode .data-point span:first-child {
             color: var(--text-dark);
        }


        /* --- Section Vitesse Principale --- */
        #speed-main {
            text-align: center;
            padding: 20px 0;
            background-color: var(--primary);
            color: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        #speed-stable {
            font-size: 3.5em;
            font-weight: 800;
            display: block;
            line-height: 1;
        }

        #speed-label {
            font-size: 1.2em;
            font-weight: 300;
            margin-top: -5px;
        }

        /* --- Contr√¥les et Boutons --- */
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .control-input, .control-input-full {
            margin-bottom: 10px;
        }

        .control-input-full {
            grid-column: 1 / 3;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
            font-weight: 600;
        }

        input[type="number"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #f9f9f9;
        }
        
        .btn {
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: background-color 0.2s, opacity 0.2s;
            width: 100%;
        }

        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover { background-color: #2980b9; }

        .btn-success { background-color: var(--success); color: white; }
        .btn-success:hover { background-color: #27ae60; }
        
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-danger.active, .btn-danger:hover { background-color: #c0392b; }
        
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }

        /* --- Carte (Leaflet) --- */
        #map-container {
            flex-grow: 1;
            position: relative;
            min-height: 400px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        #map {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            z-index: 1;
        }

        .map-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            z-index: 1000;
        }

        body.dark-mode .map-overlay {
            background: rgba(30, 30, 30, 0.8);
            color: var(--text-dark);
        }

        /* --- Section Astro / Soleil-Lune --- */
        #astro-visualizer {
            position: relative;
            height: 120px;
            background: linear-gradient(180deg, #87ceeb 0%, #ffffff 70%); /* Jour */
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode #astro-visualizer {
            background: linear-gradient(180deg, #101525 0%, #1e1e1e 70%); /* Nuit */
        }

        /* El√©ments Solaires/Lunaires */
        .celestial-body {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            position: absolute;
            left: 50%;
            margin-left: -10px;
            transition: all 4s ease-out;
            z-index: 5;
        }

        #sun-element {
            background: #ffcc00;
            box-shadow: 0 0 10px #ffcc00, 0 0 20px rgba(255, 204, 0, 0.5);
        }

        #moon-element {
            background: #f0f0f0;
            box-shadow: 0 0 10px rgba(240, 240, 240, 0.5);
            width: 16px;
            height: 16px;
            margin-left: -8px;
            z-index: 6;
        }

        /* Horizon (Ligne de d√©marcation) */
        #horizon {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50%; /* La moiti√© inf√©rieure */
            background-color: #795548; /* Couleur par d√©faut (biome) */
            z-index: 4;
            transition: background-color 0.5s;
        }
        
        /* Z√©nith Sky Mode */
        body.zenith-sky #astro-visualizer {
            background: linear-gradient(0deg, #87ceeb 0%, #ffffff 70%); 
        }

    </style>
</head>
<body class="dark-mode"> <div id="left-panel" class="panel">
        <h1><i class="fas fa-tachometer-alt"></i> GNSS Dash</h1>
        
        <h2><i class="fas fa-cogs"></i> Contr√¥les & Syst√®me</h2>
        
        <div class="data-point"><span>Heure Locale (NTP)</span><span id="local-time">SYNCHRO √âCHOU√âE (Local)</span></div>
        <div class="data-point"><span>Date Locale (UTC)</span><span id="date-display">N/A</span></div>
        <div class="data-point"><span>Temps √©coul√© (Session)</span><span id="elapsed-time">0.00 s</span></div>
        <div class="data-point"><span>Temps de Mouvement</span><span id="time-moving">0.00 s</span></div>
        <div class="data-point"><span>Heure Minecraft</span><span id="mc-time">00:52</span></div>
        
        <div class="controls-grid" style="margin-top: 15px;">
            <button id="toggle-gps-btn" class="btn btn-primary">‚ñ∂Ô∏è MARCHE GPS</button>
            <button id="emergency-stop-btn" class="btn btn-danger">üõë Arr√™t d'urgence: INACTIF üü¢</button>
            <button id="toggle-mode-btn" class="btn btn-primary"><i class="fas fa-moon"></i> Mode Nuit</button>
            <button id="xray-mode-btn" class="btn btn-primary"><i class="fas fa-radiation"></i> Rayons-X</button>
            <button id="reset-dist-btn" class="btn btn-primary">R√©init. Dist.</button>
            <button id="reset-max-btn" class="btn btn-primary">R√©init. V-Max</button>
            <button id="reset-all-btn" class="btn btn-danger" style="grid-column: 1 / 3;">TOUT R√âINITIALISER</button>
        </div>
        
        <div class="control-input-full">
            <label for="gps-accuracy-override">Forcer Pr√©cision GPS (m) [0=Auto]</label>
            <input type="number" id="gps-accuracy-override" value="0" step="0.1" min="0">
        </div>

        <div class="control-input-full">
             <label for="environment-select">Environnement (Filtre Kalman)</label>
             <select id="environment-select">
                <option value="NORMAL">Normal</option>
                <option value="CITY">Urbain (Signal moyen)</option>
                <option value="MOUNTAIN">Montagne (Signal perturb√©)</option>
                <option value="FOREST">For√™t (Signal faible)</option>
            </select>
            <span id="env-factor" style="font-size: 0.8em;">Normal (x1.0)</span>
        </div>

        <div class="control-input-full">
            <label for="mass-input">Masse de l'objet (kg)</label>
            <input type="number" id="mass-input" value="70" step="0.1" min="0">
            <span id="current-mass">70.000 kg</span>
        </div>

        <div class="control-input-full">
             <label for="celestial-body-select">Corps C√©leste (Gravit√©)</label>
             <select id="celestial-body-select">
                <option value="EARTH">Terre</option>
                <option value="MOON">Lune</option>
                <option value="MARS">Mars</option>
                <option value="ROTATING">Rotation (Man√®ge/ISS)</option>
            </select>
            <span id="gravity-display">9.8067 m/s¬≤</span>
        </div>
        
        <div class="data-point"><span>Mode G√©ocentrique</span><span id="geocentric-ratio">1.000</span></div>

    </div>

    <div id="center-map">
        
        <div id="speed-main">
            <span id="speed-stable">--.-</span>
            <span id="speed-label">km/h</span>
            <div id="gps-status-dr" class="map-overlay" style="position: static; margin-top: 10px; display: inline-block;">Attente du signal GPS...</div>
        </div>

        <div id="map-container">
            <div id="map"></div>
            <div class="map-overlay">Pr√©cision GPS (Acc): <span id="gps-accuracy">N/A</span></div>
            <div class="map-overlay" style="top: 35px; left: 10px;">Statut EKF: <span id="ekf-status">Actif</span></div>
            <div class="map-overlay" style="top: 60px; left: 10px;"><i class="fas fa-route"></i> Fusion EKF: <span id="underground-status">Initialisation...</span></div>
        </div>
    </div>

    <div id="right-panel" class="panel">

        <h2><i class="fas fa-space-shuttle"></i> Vitesse & Distance</h2>
        <div class="data-point"><span>Vitesse Stable (m/s)</span><span id="speed-stable-ms">-- m/s</span></div>
        <div class="data-point"><span>Vitesse Stable (km/s)</span><span id="speed-stable-kms">-- km/s</span></div>
        <div class="data-point"><span>Vitesse 3D (Instantan√©e)</span><span id="speed-3d-inst">-- km/h</span></div>
        <div class="data-point"><span>Vitesse Brute (m/s)</span><span id="speed-raw-ms">-- m/s</span></div>
        <div class="data-point"><span>Vitesse Max (Session)</span><span id="speed-max">0.0 km/h</span></div>
        <div class="data-point"><span>Vitesse Moyenne (Mvt)</span><span id="speed-avg-moving">0.0 km/h</span></div>
        <div class="data-point"><span>Vitesse Moyenne (Total)</span><span id="speed-avg-total">0.0 km/h</span></div> <div class="data-point"><span>% Vitesse du Son</span><span id="perc-speed-sound">0.00 %</span></div>
        <div class="data-point"><span>Nombre de Mach</span><span id="mach-number">0.0000</span></div>
        <div class="data-point"><span>% Vitesse Lumi√®re (c)</span><span id="perc-speed-c">0.00e+0 %</span></div>
        <div class="data-point"><span>Facteur de Lorentz (Œ≥)</span><span id="lorentz-factor">1.0000</span></div>
        <hr>
        <div class="data-point"><span>Distance Totale (3D)</span><span id="distance-total-km">0.000 km | 0.00 m</span></div>
        <div class="data-point"><span>Distance (s-lumi√®re)</span><span id="dist-light-s">0.00e+00 s</span></div>
        <h2><i class="fas fa-globe-americas"></i> Position & Astro</h2>
        
        <div id="astro-visualizer">
             <div id="sun-element" class="celestial-body">‚òÄÔ∏è</div>
             <div id="moon-element" class="celestial-body">üåô</div>
             <div id="horizon"></div>
        </div>
        <div class="data-point"><span>Statut Ciel</span><span id="clock-status">Nuit/Cr√©puscule (üåô)</span></div>
        <div class="data-point"><span>Latitude (EKF)</span><span id="lat-display">N/A</span></div>
        <div class="data-point"><span>Longitude (EKF)</span><span id="lon-display">N/A</span></div>
        <div class="data-point"><span>Altitude (EKF)</span><span id="alt-display">N/A</span></div>
        <div class="data-point"><span>Altitude Baro (Corr.)</span><span id="pressure-alt">N/A</span></div> <div class="data-point"><span>Altitude G√©opotentielle</span><span id="geopotential-alt">N/A</span></div>
        <div class="data-point"><span>Cap (Magn√©tom√®tre)</span><span id="cap-display">N/A</span></div>
        <div class="data-point"><span>Date (Astro)</span><span id="date-display-astro">N/A</span></div>
        <div class="data-point"><span>Heure Solaire Vraie (TST)</span><span id="tst">N/A</span></div> <div class="data-point"><span>Heure Solaire Moyenne (MST)</span><span id="mst">N/A</span></div> <div class="data-point"><span>Midi Solaire Local (UTC)</span><span id="noon-solar">N/A</span></div>
        <div class="data-point"><span>√âquation du Temps (EOT)</span><span id="eot">N/A</span></div>
        <div class="data-point"><span>Phase Lune</span><span id="moon-phase-name">N/A</span></div>

        <h2><i class="fas fa-microchip"></i> Capteurs IMU & Env.</h2>
        <div class="data-point"><span>Acc√©l√©ration X</span><span id="imu-accel-x">0.00 m/s¬≤</span></div>
        <div class="data-point"><span>Acc√©l√©ration Y</span><span id="imu-accel-y">0.00 m/s¬≤</span></div>
        <div class="data-point"><span>Acc√©l√©ration Z</span><span id="imu-accel-z">0.00 m/s¬≤</span></div>
        <div class="data-point"><span>Statut Capteur</span><span id="imu-status">Actif (IMU/Mag)</span></div>
        <hr>
        <div class="data-point"><span>Champ Magn√©tique</span><span id="magnetic-field">N/A ŒºT</span></div> <div class="data-point"><span>Max Magn√©tique</span><span id="magnetic-field-max">0.00 ŒºT</span></div> <div class="data-point"><span>Moy. Magn√©tique</span><span id="magnetic-field-avg">0.00 ŒºT</span></div> <div class="data-point"><span>Niveau Sonore</span><span id="sound-level">N/A dB</span></div> <div class="data-point"><span>Niveau Lumineux</span><span id="light-level">N/A lux</span></div> <h2><i class="fas fa-cloud-sun"></i> M√©t√©o & Biophysique</h2>
        <div class="data-point"><span>Temp. Air</span><span id="temp-air-2">N/A</span></div>
        <div class="data-point"><span>Pression Atm.</span><span id="pressure-2">N/A</span></div>
        <div class="data-point"><span>Humidit√© Relative</span><span id="humidity-2">N/A</span></div>
        <div class="data-point"><span>Point de Ros√©e</span><span id="dew-point">N/A</span></div>
        <div class="data-point"><span>Densit√© de l'Air</span><span id="air-density">N/A</span></div>
        <div class="data-point"><span>Humidit√© Absolue</span><span id="abs-humidity">N/A</span></div>
        <div class="data-point"><span>Temp. Thermom√®tre Mouill√©</span><span id="wet-bulb-temp">N/A</span></div>
        <div class="data-point"><span>Indice de Stabilit√© (CAPE)</span><span id="CAPE">N/A</span></div>
        <div class="data-point"><span>Saturation O‚ÇÇ Th√©o.</span><span id="O2-saturation">N/A</span></div>
        <div class="data-point"><span>Photosynth√®se</span><span id="photosynthesis-rate">N/A</span></div>
        <div class="data-point"><span>Taux d'Oxyg√®ne (O‚ÇÇ)</span><span id="o2-level">20.9 % vol</span></div>

        <h2><i class="fas fa-atom"></i> Physique Avanc√©e & Fluides</h2>
        <div class="data-point"><span>Vitesse du Son Locale</span><span id="speed-of-sound-local">N/A</span></div>
        <div class="data-point"><span>Temps Dilation (Vitesse)</span><span id="time-dilation-speed">0.00 ns/j</span></div>
        <div class="data-point"><span>Temps Dilation (Gravit√©)</span><span id="time-dilation-gravity">0.00 ns/j</span></div>
        <div class="data-point"><span>√ânergie Relativiste (E)</span><span id="energy-relativistic">N/A</span></div>
        <div class="data-point"><span>√ânergie de Masse au Repos (E‚ÇÄ)</span><span id="energy-rest-mass">N/A</span></div>
        <div class="data-point"><span>Rayon de Schwarzschild (R‚Çõ)</span><span id="schwarzschild-radius">N/A</span></div>
        <div class="data-point"><span>Quantit√© de Mouvement</span><span id="momentum">N/A</span></div>
        <div class="data-point"><span>Nombre de Reynolds</span><span id="reynolds-number">N/A</span></div>
        <div class="data-point"><span>Pression Dynamique (q)</span><span id="dynamic-pressure">0.00 Pa</span></div>
        <div class="data-point"><span>Force de Tra√Æn√©e</span><span id="drag-force">0.00 N</span></div>
        <div class="data-point"><span>Pression de Radiation</span><span id="radiation-pressure">N/A</span></div>
        <div class="data-point"><span>Force de Coriolis</span><span id="coriolis-force">0.00 N</span></div>
        <div class="data-point"><span>Gravit√© Locale (g)</span><span id="gravity-local">N/A</span></div>
        <div class="data-point"><span>Acc√©l√©ration Long.</span><span id="accel-long">N/A</span></div>

        <h2><i class="fas fa-brain"></i> Filtre EKF & Debug</h2>
        <div class="data-point"><span>Incertitude Vitesse (P)</span><span id="kalman-uncert">N/A</span></div>
        <div class="data-point"><span>Incertitude Alt. (œÉ)</span><span id="kalman-uncert-alt">N/A</span></div>
        <div class="data-point"><span>Bruit Mesure Vitesse (R)</span><span id="speed-error-perc">N/A</span></div>
        <div class="data-point"><span>Bande Passante (Nyquist)</span><span id="nyquist-frequency">N/A</span></div>
        <div class="data-point"><span>Statut GPS & EKF</span><span id="gps-status-debug">Actif</span></div>
        <div class="data-point"><span>Forcer Pr√©cision GPS</span><span id="gps-accuracy-override-display">0.000000 m</span></div>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20n6RzR5n2J/kX6B/L8YF7b+c8v8oP5/x6R6rA5/E4s="
            crossorigin=""></script>
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
    
    <script>
        
        <script src="gnss-dashboard-full.js"></script>
    
    </script>
</body>
    </html>
