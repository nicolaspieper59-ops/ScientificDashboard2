<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord GNSS/IMU (Filtre de Kalman Automatique)</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.1/math.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f4; }
        h1 { color: #333; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .data-item strong { display: block; font-size: 0.9em; color: #555; }
        .value { font-size: 1.4em; font-weight: bold; color: #007bff; }
        #map { height: 400px; border-radius: 8px; margin-top: 20px; }
        .controls { display: flex; gap: 10px; align-items: center; margin-bottom: 20px; }
        .controls button { padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .controls select { padding: 10px; border-radius: 5px; }
        .status-bar { padding: 10px; background-color: #ffc107; color: #333; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>üöÄ Simulateur de Fusion GNSS/IMU (EKF 6-DoF)</h1>

    <div class="controls">
        <button id="toggle-gps-btn">D√©marrer la Fusion (GPS/IMU)</button>
        
        <label for="transport-mode-select">Mode de Transport/Physique (Initialisation) :</label>
        <select id="transport-mode-select">
            <option value="INS_6DOF_REALISTE" selected>INS 6-DoF (D√©tection Automatique CNH)</option>
            <option value="CAR_PEDESTRIAN">Voiture/Pi√©ton (CNH Manuelle simple)</option>
            <option value="TRAIN_METRO">Train/M√©tro (CNH Manuelle Rail)</option>
            <option value="AIRCRAFT">A√©ronef (CNH Manuelle 3D)</option>
            <option value="CARTOON_PHYSICS">Lois Cartoon (G=0.1)</option>
            <option value="SPACETIME_DRIVE">Voyage Espace-Temps (Vitesse Max)</option>
        </select>
    </div>

    <div class="status-bar" id="gps-status-dr">Initialisation...</div>

    <div class="dashboard">
        <div class="panel">
            <h2>Sortie EKF (Filtre Kalman)</h2>
            <div class="data-grid">
                <div class="data-item">
                    <strong>Vitesse Stabilis√©e (m/s)</strong>
                    <span class="value" id="speed-stable">0.00</span>
                </div>
                <div class="data-item">
                    <strong>Vitesse (km/h)</strong>
                    <span class="value" id="current-speed">0.00</span>
                </div>
                <div class="data-item">
                    <strong>Altitude EKF (m)</strong>
                    <span class="value" id="altitude-kalman">0.00</span>
                </div>
                <div class="data-item">
                    <strong>Incertitude EKF (P)</strong>
                    <span class="value" id="kalman-uncert">1000.00</span>
                </div>
            </div>

            <h3 style="margin-top: 15px;">Composantes 6-DoF (DR)</h3>
            <div class="data-grid">
                <div class="data-item">
                    <strong>Vitesse X (m/s)</strong>
                    <span class="value" id="speed-x">0.00</span>
                </div>
                <div class="data-item">
                    <strong>Vitesse Y (m/s)</strong>
                    <span class="value" id="speed-y">0.00</span>
                </div>
                <div class="data-item">
                    <strong>Pos X (D√©rive m)</strong>
                    <span class="value" id="pos-x">0.00</span>
                </div>
                <div class="data-item">
                    <strong>Pos Y (D√©rive m)</strong>
                    <span class="value" id="pos-y">0.00</span>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>Diagnostics EKF et Contraintes</h2>
            <div class="data-grid">
                <div class="data-item">
                    <strong>Biais Acc√©l. Estim√© (Q)</strong>
                    <span class="value" id="kalman-q-noise">0.000</span>
                </div>
                <div class="data-item">
                    <strong>Fiabilit√© GPS (R Dyn)</strong>
                    <span class="value" id="kalman-r-dyn">500.00</span>
                </div>
            </div>
            
            <h3 style="margin-top: 15px;">Statut de la Contrainte</h3>
            <div class="status-bar" id="nhc-status" style="background-color: #17a2b8; color: white;">Gravit√© Locale: 9.81 m/s¬≤</div>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script src="gnss-dashboard-full.js"></script>

</body>
                </html>
