<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ∞Ô∏è Fusion GNSS/IMU Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        /* CSS Minimal (pour le th√®me sombre et la structure) */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; transition: background-color 0.5s, color 0.5s; }
        body.dark-mode { background-color: #1e1e1e; color: #d4d4d4; }
        .dashboard-container { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; padding: 20px; }
        .panel { background-color: #f0f0f0; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        body.dark-mode .panel { background-color: #333; }
        .data-label { font-weight: bold; margin-top: 10px; }
        .data-value { font-family: monospace; font-size: 1.1em; color: #007bff; }
        body.dark-mode .data-value { color: #8ab4f8; }
        #map-container { height: 300px; border-radius: 4px; margin-top: 10px; }
        button, select { padding: 8px 12px; border-radius: 4px; cursor: pointer; }
        #sun-element { width: 10px; height: 10px; background-color: gold; border-radius: 50%; position: absolute; top: 0; left: 50%; transform: translate(-50%, -120%); transition: transform 1s; }
        #moon-element { width: 8px; height: 8px; background-color: silver; border-radius: 50%; position: absolute; top: 0; left: 50%; transform: translate(-50%, -120%); transition: transform 1s; }
        .astro-clock { position: relative; width: 100px; height: 100px; border: 1px solid #ccc; border-radius: 50%; margin: 10px auto; }
        .center-line { width: 1px; height: 50%; background-color: #ccc; position: absolute; top: 0; left: 50%; transform: translateX(-50%); }
    </style>
</head>
<body>

    <header style="padding: 20px; text-align: center;">
        <h1>üõ∞Ô∏è GNSS/IMU Fusion Dashboard</h1>
        <div style="margin-top: 10px;">
            <button id="toggle-gps-btn" style="background-color: #28a745;">‚ñ∂Ô∏è MARCHE GPS</button>
            <button id="emergency-stop-btn" style="background-color: #dc3545;">üõë Arr√™t d'urgence: INACTIF üü¢</button>
            <button id="toggle-mode-btn">üåô Th√®me Sombre</button>
        </div>
        <div style="margin-top: 10px;">
            <select id="freq-select">
                <option value="HIGH_FREQ">Haute Fr√©quence (Optimale)</option>
                <option value="LOW_FREQ">Basse Fr√©quence (√âconomie)</option>
            </select>
            <select id="environment-select">
                <option value="OPEN">Environnement: Ouvert (Faible bruit)</option>
                <option value="FOREST">Environnement: For√™t</option>
                <option value="CONCRETE">Environnement: Urbain (B√©ton)</option>
                <option value="METAL">Environnement: Industriel (M√©tal)</option>
            </select>
        </div>
    </header>

    <div class="dashboard-container">
        <div class="main-data">

            <div class="panel">
                <h2>üöÄ Performance Dynamique</h2>
                <div style="display: flex; justify-content: space-around;">
                    <div>
                        <div class="data-label">Vitesse Max Atteinte (Horiz.):</div>
                        <div id="speed-max" class="data-value">0.0000 km/h</div>
                    </div>
                    <div>
                        <div class="data-label">Temps √âcoul√© Total:</div>
                        <div id="time-elapsed" class="data-value">0.00 s</div>
                    </div>
                </div>

                <hr/>
                <div style="display: flex; justify-content: space-around;">
                    <div>
                        <div class="data-label">Vitesse Stable (EKF, 3D):</div>
                        <div id="speed-stable" class="data-value">0.0000 km/h (3D)</div>
                        <div id="speed-stable-ms" class="data-value">0.000 m/s (3D)</div>
                    </div>
                    <div>
                        <div class="data-label">Vitesse Verticale:</div>
                        <div id="vertical-speed" class="data-value">0.00 m/s</div>
                    </div>
                </div>

                <hr/>
                <div style="display: flex; justify-content: space-around;">
                    <div>
                        <div class="data-label">Acc√©l√©ration Longitudinale (EKF):</div>
                        <div id="accel-long" class="data-value">0.000 m/s ¬≤</div>
                        <div class="data-label">Force G Longitudinale:</div>
                        <div id="force-g-long" class="data-value">0.00 G | Max: 0.00 G</div>
                    </div>
                    <div>
                        <div class="data-label">Force G Lat√©rale (Virage):</div>
                        <div id="force-g-lat" class="data-value">0.00 G | Max: 0.00 G</div>
                    </div>
                </div>

                <hr/>
                <h3>√ânergie & Puissance</h3>
                <div style="display: flex; justify-content: space-around;">
                    <label for="mass-input">Masse (kg):</label>
                    <input type="number" id="mass-input" value="70" style="width: 50px;">
                    <div>
                        <div class="data-label">√ânergie Cin√©tique:</div>
                        <div id="kinetic-energy" class="data-value">0.00 J</div>
                    </div>
                    <div>
                        <div class="data-label">Puissance M√©canique:</div>
                        <div id="mechanical-power" class="data-value">0.00 W</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>üìç Localisation et Mesures</h2>
                <div style="display: flex; justify-content: space-around;">
                    <div>
                        <div class="data-label">Latitude:</div>
                        <div id="latitude" class="data-value">0.000000</div>
                        <div class="data-label">Longitude:</div>
                        <div id="longitude" class="data-value">0.000000</div>
                        <div class="data-label">Altitude GPS:</div>
                        <div id="altitude-gps" class="data-value">N/A</div>
                    </div>
                    <div>
                        <div class="data-label">Distance Totale (3D):</div>
                        <div id="distance-total-km" class="data-value">0.000 km | 0.00 m (3D)</div>
                        <div class="data-label">Temps de D√©placement:</div>
                        <div id="time-moving" class="data-value">0.00 s</div>
                        <div class="data-label">Statut Sous-Sol ($lt; -50m):</div>
                        <div id="underground-status" class="data-value">Non</div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 15px;">
                    <button id="reset-dist-btn">üîÑ R√©initialiser Distance</button>
                    <button id="reset-max-btn">üîÑ R√©initialiser Max Vitesse/G</button>
                </div>
            </div>

            <div class="panel">
                <h2>üî¨ Diagnostics IMU & EKF</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div>
                        <div class="data-label">Pr√©cision Horizontale GPS:</div>
                        <div id="gps-precision" class="data-value">N/A</div>
                        <div class="data-label">Incertitude EKF (kUncert):</div>
                        <div id="kalman-uncert" class="data-value">0.00000 m¬≤ (Horiz.) | Q: N/A</div>
                        <div class="data-label">Mesure de Confiance (R):</div>
                        <div id="kalman-r-dyn" class="data-value">DR Mode (IMU) | R-Factor: 1.0</div>
                    </div>
                    <div>
                        <div class="data-label">Cap Actuel utilis√©:</div>
                        <div id="current-heading" class="data-value">0.0 ¬∞ (N/A)</div>
                        <div class="data-label">Accel. Lin√©aire Corrig√©e (3D):</div>
                        <div id="accel-linear-corrected" class="data-value">0.000 m/s¬≤</div>
                        <div class="data-label">Gravit√© Calcul√©e (X, Y, Z):</div>
                        <div id="gravity-calculated" class="data-value">N/A m/s¬≤</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="side-data">
            <div class="panel">
                <h2>üó∫Ô∏è Carte</h2>
                <div id="map-container"></div>
            </div>

            <div class="panel">
                <h2>üåå Calendrier Cosmique & Minecraft</h2>
                <div style="display: flex; justify-content: space-around; align-items: center;">
                    <div>
                        <div class="data-label">Heure Locale (Synchronis√©e):</div>
                        <div id="local-time" class="data-value">N/A</div>
                        <div class="data-label">Heure Minecraft:</div>
                        <div id="mc-time" class="data-value">00:00:00</div>
                        <div class="data-label">Mode Nether:</div>
                        <div id="mode-nether" class="data-value">D√âSACTIV√â (1:1)</div>
                        <button id="nether-toggle-btn">Activer Nether</button>
                    </div>
                    <div style="text-align: center;">
                        <div class="astro-clock">
                            <div class="center-line"></div>
                            <div id="sun-element"></div>
                            <div id="moon-element"></div>
                        </div>
                        <div id="tst" class="data-value">N/A</div>
                        <div id="moon-phase-display" class="data-value">Phase: N/A</div>
                    </div>
                </div>

                <hr/>
                <h3>Vitesse Cosmique</h3>
                <div class="data-label">% Vitesse du Son:</div>
                <div id="perc-speed-sound" class="data-value">0.00%</div>
                <div class="data-label">% Vitesse de la Lumi√®re:</div>
                <div id="perc-speed-c" class="data-value">0.00e+00%</div>
            </div>

            <div class="panel">
                <h2>‚òÅÔ∏è M√©t√©o (OpenWeatherMap)</h2>
                <div class="data-label">Temp√©rature de l'air:</div>
                <div id="temp-air" class="data-value">N/A</div>
                <div class="data-label">Pression Atmosph√©rique:</div>
                <div id="pressure" class="data-value">N/A</div>
                <div class="data-label">Vitesse du vent:</div>
                <div id="wind-speed-ms" class="data-value">N/A</div>
            </div>
            
            <div class="panel">
                <h2>üî≠ Niveau √† Bulle & Correction 3D</h2>
                <div class="data-label">Pitch (Tangage):</div>
                <div id="pitch-angle" class="data-value">0.0 ¬∞</div>
                <div class="data-label">Roll (Roulis):</div>
                <div id="roll-angle" class="data-value">0.0 ¬∞</div>
                <div class="data-label">Force G Verticale (Gravit√©):</div>
                <div id="force-g-vertical" class="data-value">0.00 G</div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/suncalc@1.8.0/suncalc.min.js"></script>
    <script src="gnss-dashboard-full.js"></script>
</body>
    </html>
