<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GNSS SpaceTime Dashboard ‚Ä¢ EKF Fusion Professionnel üöÄ</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20n6a9c4Qk+Jj37+V/vYdJz5A9Z8oN9L8c3S0D9n6bWw=" crossorigin=""></script>
    <script src="https://unpkg.com/suncalc@1.8.0/suncalc.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" 
          integrity="sha512-Fo3rlrZj/k7ujTnHg4CfmjR7mQUFm94/Nfae/Y55JjNfX/YvD9eD+N6n7N2+3X5C6ZqT2C2F+V+h/lVj7T1/qA=" 
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* --- Styles du Dashboard --- */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            background-color: #f4f7f9; 
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }
        .dashboard-container { 
            display: grid; 
            grid-template-columns: 1fr 2fr; /* Col 1: Contr√¥les/Donn√©es | Col 2: Carte/Astro */
            gap: 20px; 
            padding: 20px; 
            max-width: 1400px; 
            margin: 0 auto;
        }
        .panel { 
            background-color: #fff; 
            padding: 15px; 
            border-radius: 8px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            margin-bottom: 20px;
        }
        h2 { 
            border-bottom: 2px solid #007bff; 
            padding-bottom: 5px; 
            margin-top: 0; 
            color: #007bff;
            font-size: 1.2em;
        }
        .data-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 10px; 
        }
        .data-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 5px 0; 
            border-bottom: 1px dashed #eee;
        }
        .label { 
            font-weight: 600; 
            font-size: 0.9em;
        }
        .value { 
            color: #28a745; 
            font-family: monospace;
            font-size: 0.9em;
        }
        #map { 
            height: 400px; 
            border-radius: 8px; 
            margin-bottom: 20px;
        }
        .control-panel button, .control-panel select, .control-panel input {
            padding: 8px 12px;
            margin: 5px 5px 5px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #emergency-stop-btn.active {
            background-color: #dc3545;
            color: white;
        }

        /* --- Styles Astro Visualisation --- */
        .clock-visualization {
            position: relative;
            height: 200px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background: linear-gradient(180deg, #87ceeb 0%, #ffffff 100%);
            margin-bottom: 20px;
        }
        .celestial-body {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            transition: transform 1s;
        }
        .celestial-body .sun-icon, .celestial-body .moon-icon {
            position: absolute;
            top: 50%;
            font-size: 2em;
            transition: transform 1s;
        }
        .celestial-body.sun .sun-icon { color: orange; }
        .celestial-body.moon .moon-icon { color: lightgray; }
        
        /* --- Dark Mode Styles --- */
        .dark-mode {
            background-color: #1a1a2e;
            color: #e0e0e0;
        }
        .dark-mode .panel {
            background-color: #1f4068;
            box-shadow: 0 4px 6px rgba(0,0,0,0.5);
        }
        .dark-mode h2 {
            border-bottom-color: #46cdcf;
            color: #46cdcf;
        }
        .dark-mode .value {
            color: #90ee90;
        }
        .dark-mode .data-item {
            border-bottom-color: #3e5c76;
        }
        .dark-mode .clock-visualization {
             background: linear-gradient(180deg, #120e2a 0%, #1f4068 100%);
        }
    </style>
</head>
<body class="light-mode">

    <header style="background-color: #007bff; color: white; padding: 10px 20px;">
        <h1>Syst√®me de Navigation Avanc√© GNSS-UKF</h1>
    </header>

    <div class="dashboard-container">
        <div>
            <div class="panel control-panel">
                <h2><i class="fas fa-sliders-h"></i> Contr√¥les Syst√®me</h2>
                <div style="display: flex; flex-wrap: wrap; align-items: center;">
                    <button id="toggle-gps-btn" style="background-color: #28a745; color: white;">‚ñ∂Ô∏è MARCHE GPS</button>
                    <button id="emergency-stop-btn" style="background-color: #ffc107;">üõë Arr√™t d'urgence: INACTIF üü¢</button>
                    <button id="nether-toggle-btn">Toggle Nether</button>
                    <button id="toggle-mode-btn">Mode Clair/Sombre</button>
                    
                    <label for="freq-select">Fr√©quence GPS:</label>
                    <select id="freq-select" onchange="setGPSMode(this.value)">
                        <option value="HIGH_FREQ" selected>Haute (1Hz+)</option>
                        <option value="LOW_FREQ">Basse (2min)</option>
                    </select>

                    <label for="mass-input">Masse (kg):</label>
                    <input type="number" id="mass-input" value="70.0" step="0.1" min="0.1" style="width: 80px;">
                    <span class="value" id="mass-display">70.000 kg</span>
                </div>
            </div>

            <div class="panel">
                <h2><i class="fas fa-tachometer-alt"></i> Vitesse & Performance</h2>
                <div class="data-grid">
                    <div class="data-item"><span class="label">Vitesse Stable (km/h)</span><span class="value" id="speed-stable">0.00000</span></div>
                    <div class="data-item"><span class="label">Vitesse Max (km/h)</span><span class="value" id="speed-max">0.00000</span></div>
                    <div class="data-item"><span class="label">Vitesse Stable (m/s)</span><span class="value" id="speed-stable-ms">0.000 m/s | 0 ¬µm/s | 0 nm/s</span></div>
                    <div class="data-item"><span class="label">Vitesse 3D (Brute km/h)</span><span class="value" id="speed-3d-inst">0.00000</span></div>
                    <div class="data-item"><span class="label">Vitesse Avg. (Mouv.)</span><span class="value" id="speed-avg-moving">0.00000 km/h</span></div>
                    <div class="data-item"><span class="label">Vitesse Stable (km/s)</span><span class="value" id="speed-stable-kms">0.000e+0 km/s</span></div>
                    <div class="data-item"><span class="label">% Vitesse du Son</span><span class="value" id="perc-speed-sound">0.00 %</span></div>
                    <div class="data-item"><span class="label">% Vitesse Lumi√®re (c)</span><span class="value" id="perc-speed-c">0.00e-9 %</span></div>
                </div>
            </div>

            <div class="panel">
                <h2><i class="fas fa-route"></i> Distance & Temps</h2>
                <div class="data-grid">
                    <div class="data-item"><span class="label">Distance Totale</span><span class="value" id="distance-total-km">0.000 km | 0.00 m</span></div>
                    <div class="data-item"><span class="label">Temps √âcoul√©</span><span class="value" id="time-elapsed">0.00 s</span></div>
                    <div class="data-item"><span class="label">Temps en Mouvement</span><span class="value" id="time-moving">0.00 s</span></div>
                    <div class="data-item"><span class="label">Distance Cosmique</span><span class="value" id="distance-cosmic">0.00e-9 UA | 0.00e-14 al</span></div>
                    <div class="data-item"><span class="label">Temps Lumi√®re (s)</span><span class="value" id="distance-light-s">0.00e-9 s</span></div>
                    <div class="data-item"><span class="label">Temps Lumi√®re (min)</span><span class="value" id="distance-light-min">0.00e-11 min</span></div>
                    <div class="data-item"><span class="label">Temps Lumi√®re (h)</span><span class="value" id="distance-light-h">0.00e-13 h</span></div>
                    <div class="data-item"><span class="label">Temps Lumi√®re (jours)</span><span class="value" id="distance-light-day">0.00e-13 jours</span></div>
                    <div class="data-item"><span class="label">Temps Lumi√®re (sem)</span><span class="value" id="distance-light-week">0.00e-14 sem</span></div>
                    <div class="data-item"><span class="label">Temps Lumi√®re (mois)</span><span class="value" id="distance-light-month">0.00e-15 mois</span></div>
                </div>
                <div class="control-panel" style="margin-top: 10px;">
                    <button id="reset-dist-btn">R√©init. Distance</button>
                    <button id="reset-max-btn">R√©init. Max Vitesse</button>
                    <button id="reset-all-btn">R√©init. Session</button>
                </div>
            </div>

            <div class="panel">
                <h2><i class="fas fa-microchip"></i> IMU & Acc√©l√©ration</h2>
                <p>Statut IMU: <span id="imu-status">Inactif</span></p>
                <div class="data-grid">
                    <div class="data-item"><span class="label">Accel X</span><span class="value" id="imu-accel-x">0.00 m/s¬≤</span></div>
                    <div class="data-item"><span class="label">Accel Y</span><span class="value" id="imu-accel-y">0.00 m/s¬≤</span></div>
                    <div class="data-item"><span class="label">Accel Z</span><span class="value" id="imu-accel-z">0.00 m/s¬≤</span></div>
                    <div class="data-item"><span class="label">Attitude (Roll)</span><span class="value" id="attitude-roll">0.00 ¬∞</span></div>
                    <div class="data-item"><span class="label">Attitude (Pitch)</span><span class="value" id="attitude-pitch">0.00 ¬∞</span></div>
                    <div class="data-item"><span class="label">Attitude (Yaw)</span><span class="value" id="attitude-yaw">0.00 ¬∞</span></div>
                </div>
            </div>
        </div>

        <div>
            <div id="map"></div>
            
            <div class="panel">
                <h2><i class="fas fa-satellite-dish"></i> GPS & Altitude (UKF)</h2>
                <div class="data-grid">
                    <div class="data-item"><span class="label">Latitude</span><span class="value" id="latitude">N/A</span></div>
                    <div class="data-item"><span class="label">Longitude</span><span class="value" id="longitude">N/A</span></div>
                    <div class="data-item"><span class="label">Altitude (UKF)</span><span class="value" id="altitude-gps">N/A</span></div>
                    <div class="data-item"><span class="label">Pr√©cision (m)</span><span class="value" id="gps-precision">N/A</span></div>
                    <div class="data-item"><span class="label">Vitesse Verticale</span><span class="value" id="vertical-speed">0.00 m/s</span></div>
                    <div class="data-item"><span class="label">Cap (Heading)</span><span class="value" id="heading-display">N/A</span></div>
                </div>
                <p style="margin-top: 10px; font-style: italic; color: #555;"><span id="underground-status">Souterrain: Non (N/A)</span></p>
            </div>
            
            <div class="panel">
                <h2><i class="fas fa-atom"></i> Dynamique & Filtres</h2>
                <div class="data-grid">
                    <div class="data-item"><span class="label">Gravit√© Locale</span><span class="value" id="gravity-local">9.80665 m/s¬≤</span></div>
                    <div class="data-item"><span class="label">Force G Longitudinale</span><span class="value" id="force-g-long">0.00 G</span></div>
                    <div class="data-item"><span class="label">Acc√©l√©ration Longitudinale</span><span class="value" id="accel-long">0.000 m/s¬≤</span></div>
                    <div class="data-item"><span class="label">√ânergie Cin√©tique</span><span class="value" id="kinetic-energy">0.00 J</span></div>
                    <div class="data-item"><span class="label">Puissance M√©canique</span><span class="value" id="mechanical-power">0.00 W</span></div>
                    <div class="data-item"><span class="label">Force de Coriolis</span><span class="value" id="coriolis-force">0.00e-9 N</span></div>
                    <div class="data-item"><span class="label">Incertitude Vit. (P)</span><span class="value" id="kalman-uncert">1000.000 m¬≤/s¬≤ (P)</span></div>
                    <div class="data-item"><span class="label">Bruit de Mesure (R dyn)</span><span class="value" id="speed-error-perc">500.000 m¬≤ (R dyn)</span></div>
                    <div class="data-item"><span class="label">Incertitude Alt. (P)</span><span class="value" id="ukf-uncert-alt">10.000 m¬≤</span></div>
                </div>
            </div>
            
            <div class="panel">
                <h2><i class="fas fa-cloud-sun"></i> M√©t√©o & Configuration</h2>
                <div class="data-grid">
                    <div class="data-item"><span class="label">Date/Heure Locale</span><span class="value"><span id="date-display">N/A</span> / <span id="local-time">N/A</span></span></div>
                    <div class="data-item"><span class="label">Temp√©rature Air</span><span class="value" id="temp-air-2">N/A</span></div>
                    <div class="data-item"><span class="label">Pression Atm.</span><span class="value" id="pressure-2">N/A</span></div>
                    <div class="data-item"><span class="label">Humidit√©</span><span class="value" id="humidity-2">N/A</span></div>
                    <div class="data-item"><span class="label">Densit√© Air</span><span class="value" id="air-density">N/A</span></div>
                    <div class="data-item"><span class="label">Point de Ros√©e</span><span class="value" id="dew-point">N/A</span></div>
                    <div class="data-item"><span class="label">Corps C√©leste:</span>
                        <select id="celestial-body-select">
                            <option value="EARTH" selected>Terre (WGS84)</option>
                            <option value="MARS">Mars</option>
                            <option value="MOON">Lune</option>
                            <option value="ROTATING">Corps en Rotation</option>
                        </select>
                    </div>
                    <div class="data-item"><span class="label">Gravit√© de Base</span><span class="value" id="gravity-base">9.80665 m/s¬≤</span></div>
                    
                    <div class="data-item"><span class="label">Environnement (R):</span>
                        <select id="environment-select">
                            <option value="NORMAL" selected>Normal</option>
                            <option value="FOREST">For√™t</option>
                            <option value="CONCRETE">Grotte/Tunnel</option>
                            <option value="METAL">M√©tal/B√¢timent</option>
                        </select>
                    </div>
                    <div class="data-item"><span class="label">Facteur Environnement</span><span class="value" id="env-factor">NORMAL (x1.0)</span></div>
                    
                    <div class="data-item"><span class="label">Override Pr√©cision (m)</span>
                        <input type="number" id="gps-accuracy-override" value="0.0" step="0.1" min="0" style="width: 80px;">
                    </div>
                    <div class="data-item"><span class="label">Mode Nether</span><span class="value" id="mode-nether">D√âSACTIV√â (1:1)</span></div>
                    <div class="data-item"><span class="label">Rayon Rotation (m)</span>
                        <input type="number" id="rotation-radius" value="100" step="1" min="1" style="width: 80px;">
                    </div>
                    <div class="data-item"><span class="label">Vitesse Angulaire (rad/s)</span>
                        <input type="number" id="angular-velocity" value="0.0" step="0.1" style="width: 80px;">
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2><i class="fas fa-globe-europe"></i> Temps Solaire & Astro</h2>
                <div id="minecraft-clock" class="clock-visualization">
                    <div id="sun-element" class="celestial-body sun">
                        <div class="sun-icon">‚òÄÔ∏è</div>
                    </div>
                    <div id="moon-element" class="celestial-body moon">
                        <div class="moon-icon">üåï</div>
                    </div>
                    <div class="clock-display" style="text-align: center; z-index: 10; background: rgba(255,255,255,0.8); padding: 5px; border-radius: 5px;">
                        <p style="margin: 0; font-weight: bold;">Heure Minecraft: <span id="time-minecraft">00:00</span></p>
                        <p style="margin: 0; font-size: 0.8em; color: #555;">Statut Lumi√®re: <span id="clock-status">N/A</span></p>
                    </div>
                </div>

                <div class="data-grid">
                    <div class="data-item"><span class="label">Heure Solaire Vraie (TST)</span><span class="value" id="tst">N/A</span></div>
                    <div class="data-item"><span class="label">Heure Solaire Moyenne (MST)</span><span class="value" id="lsm">N/A</span></div>
                    <div class="data-item"><span class="label">√âquation du Temps (EOT)</span><span class="value" id="eot">N/A</span></div>
                    <div class="data-item"><span class="label">Longitude √âcliptique</span><span class="value" id="ecliptic-long">N/A</span></div>
                    <div class="data-item"><span class="label">Altitude Soleil</span><span class="value" id="sun-alt">N/A</span></div>
                    <div class="data-item"><span class="label">Azimut Soleil</span><span class="value" id="sun-azimuth">N/A</span></div>
                    <div class="data-item"><span class="label">Altitude Lune</span><span class="value" id="moon-alt">N/A</span></div>
                    <div class="data-item"><span class="label">Azimut Lune</span><span class="value" id="moon-azimuth">N/A</span></div>
                    <div class="data-item"><span class="label">Phase Lunaire</span><span class="value" id="moon-phase-name">N/A</span></div>
                    <div class="data-item"><span class="label">Illumination Lune</span><span class="value" id="moon-illuminated">N/A</span></div>
                    <div class="data-item"><span class="label">Dur√©e Journ√©e</span><span class="value" id="day-duration">N/A</span></div>
                    <div class="data-item"><span class="label">Lever/Coucher Lune</span><span class="value" id="moon-times">N/D</span></div>
                </div>
            </div>

        </div>
    </div>
    
    <script src="gnss-dashboard-full.js"></script>

</body>
    </html>
