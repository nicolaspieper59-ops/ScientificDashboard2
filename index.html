<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>GNSS SpaceTime Dashboard üöÄ (V11.1 Hors Ligne)</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIINfBIHUPz0M7mR1mZ9/3wPzSS6i8tD6U4=" 
          crossorigin=""/>
          
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" 
          integrity="sha512-Fo3rlrZj/k7ujTnHg4CfmjR7mQUFm94/Nfae/Y55JjNfX/YvD9eD+N6n7N2+3X5C6ZqT2C2F+h/lVj7T1/qA=" 
          crossorigin="anonymous" referrerpolicy="no-referrer" />
          
    <link rel="stylesheet" href="style.css">
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20n6cT8HNY9uL-ZnGg3TfQZ+6QEDH58VbT1gJcO5u5V0="
            crossorigin=""></script>
            
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
    
    <script src="gnss-dashboard-part1.js" defer></script>
    <script src="gnss-dashboard-part2.js" defer></script>
</head>
<body>

    <header>
        <h1>Tableau de Bord GNSS/IMU (V11.1 Dyn. V√©hicule)</h1>
        <div class="status-bar">
            <div class="status-item">Heure UTC (NTP): <span id="local-time">--:--:--</span></div>
            <div class="status-item">Date: <span id="date-display">N/A</span></div>
        </div>
    </header>

    <main class="dashboard-grid">

        <section class="widget map-container full-width-desktop">
            <h3>üó∫Ô∏è Localisation et Trajectoire</h3>
            <div id="map" style="height: 350px;">
                <p>Initialisation de la carte...</p>
            </div>
        </section>

        <section class="widget controls">
            <h3>Contr√¥les Syst√®me</h3>
            <button id="toggle-gps-btn">‚ñ∂Ô∏è MARCHE GPS</button>
            <select id="freq-select">
                <option value="HIGH_FREQ">Haute Fr√©quence</option>
                <option value="LOW_FREQ">Basse Fr√©quence</option>
            </select>
            <button id="emergency-stop-btn" class="danger">üõë Arr√™t d'urgence: INACTIF üü¢</button>
            <button id="nether-toggle-btn">üî• Mode Nether</button>
            <button id="reset-dist-btn" class="warning">‚ùå Distance</button>
            <button id="reset-max-btn" class="warning">‚ùå Vitesse Max</button>
            <button id="reset-all-btn" class="danger">‚ö†Ô∏è TOUT R√âINITIALISER</button>
            
            <hr>
            
            <div class="data-point">
                <span class="label">Masse Appareil/V√©hicule</span>
                <select id="mass-select" style="width: 100%;">
                    <option value="70">70 kg (D√©faut/Personne)</option>
                    <option value="1500">1500 kg (Voiture L√©g√®re)</option>
                    <option value="5000">5000 kg (Camionnette)</option>
                    <option value="15000">15000 kg (Camion)</option>
                </select>
            </div>
        </section>

        <section class="widget speed-main">
            <h3>Vitesse Stable (EKF)</h3>
            <div class="data-point primary">
                <span id="speed-stable">0.00000</span> km/h
            </div>
            <div class="data-point">
                <span class="label">Vitesse Stable (m/s | ¬µm/s)</span>
                <span id="speed-stable-ms">0.00 m/s | 0.00 ¬µm/s</span>
            </div>
            <div class="data-point">
                <span class="label">Vitesse 3D (Instantan√©e)</span>
                <span id="speed-3d-inst">0.00000 km/h</span>
            </div>
            <div class="data-point">
                <span class="label">Vitesse Max (Session)</span>
                <span id="speed-max">0.00000 km/h</span>
            </div>
            <div class="data-point">
                <span class="label">Vitesse Moyenne (Mouvement)</span>
                <span id="speed-avg-moving">0.00000 km/h</span>
            </div>
        </section>

        <section class="widget distance">
            <h3>Distance & Temps</h3>
            <div class="data-point">
                <span class="label">Distance Totale</span>
                <span id="distance-total-km">0.000 km | 0.00 m</span>
            </div>
            <div class="data-point">
                <span class="label">Distance Cosmique</span>
                <span id="distance-cosmic">0.00e+0 s lumi√®re</span>
            </div>
            <div class="data-point">
                <span class="label">Temps √©coul√© (Session)</span>
                <span id="time-elapsed">0.00 s</span>
            </div>
            <div class="data-point">
                <span class="label">Temps de Mouvement</span>
                <span id="time-moving">0.00 s</span>
            </div>
            <div class="data-point">
                <span class="label">Mode Nether (1:8)</span>
                <span id="mode-nether">D√âSACTIV√â (1:1)</span>
            </div>
        </section>
        
        <section class="widget gps-raw">
            <h3>üõ∞Ô∏è Vue brute GPS & Physique</h3>
            <div class="data-point">
                <span class="label">Latitude</span>
                <span id="latitude">--</span>
            </div>
            <div class="data-point">
                <span class="label">Longitude</span>
                <span id="longitude">--</span>
            </div>
            <div class="data-point">
                <span class="label">Altitude (Niveau Mer MSL)</span>
                <span id="altitude-gps">-- m (MSL)</span>
            </div>
            
            <hr>
            
            <div class="data-point">
                <span class="label">Acc√©l√©ration Longitudinale (EKF)</span>
                <span id="accel-long">0.000 m/s¬≤</span>
            </div>
            <div class="data-point">
                <span class="label">Acc√©l√©ration Lat√©rale (Centrifuge Est.)</span>
                <span id="accel-lat">0.000 m/s¬≤</span>
            </div>
            <div class="data-point primary-astro">
                <span class="label">Force Centrifuge (Estim√©e)</span>
                <span id="force-centrifugal">0.00 N</span>
            </div>
            <div class="data-point">
                <span class="label">Force Centrifuge (en G)</span>
                <span id="force-centrifugal-g">0.00 G</span>
            </div>
            
            <hr>
            
            <div class="data-point">
                <span class="label">Pr√©cision GPS (Seuil MIN)</span>
                <span id="gps-precision">-- m</span>
            </div>
            <div class="data-point">
                <span class="label">Vitesse Verticale (EKF)</span>
                <span id="vertical-speed">0.00 m/s</span>
            </div>
            <div class="data-point">
                <span class="label">Sous-sol (Seuil -50m)</span>
                <span id="underground-status">Non</span>
            </div>
        </section>

        <section class="widget astro-sun">
            <h3>‚òÄÔ∏è Soleil (√âph√©m√©ride & SunCalc)</h3>
            <div class="data-point">
                <span class="label">Heure Solaire Vraie (TST)</span>
                <span id="time-solar-true">--:--:--</span>
            </div>
            <div class="data-point">
                <span class="label">Heure Solaire Moyenne (LSM)</span>
                <span id="culmination-lsm">--:--:--</span>
            </div>
            
            <hr style="border-top: 1px dashed #4a4a4a;">
            
            <div class="data-point primary-astro">
                <span class="label">√âquation du Temps (Total EOT)</span>
                <span id="eot-min">-- min</span>
            </div>
            <div class="data-point">
                <span class="label">Composante Eccentricit√©</span>
                <span id="eot-ecc-comp">-- min</span>
            </div>
            <div class="data-point">
                <span class="label">Composante Obliquit√©</span>
                <span id="eot-obliq-comp">-- min</span>
            </div>
            
            <hr style="border-top: 1px dashed #4a4a4a;">
            
            <div class="data-point">
                <span class="label">Longitude √âcliptique</span>
                <span id="ecliptic-long">-- ¬∞</span>
            </div>
            <div class="data-point">
                <span class="label">√âl√©vation Solaire</span>
                <span id="sun-elevation">-- ¬∞</span>
            </div>
            <div class="data-point">
                <span class="label">Azimut Solaire</span>
                <span id="sun-azimuth">-- ¬∞</span>
            </div>
            <div class="data-point">
                <span class="label">Dur√©e du Jour Solaire</span>
                <span id="day-duration">--h --m</span>
            </div>
        </section>

        <div class="widget sensors-and-weather">
            <h2>Capteurs Locaux & M√©t√©o (EKF Correction)</h2>
            
            <div class="data-point">
                <span class="label">Pr√©cision EKF (R dyn.)</span>
                <span id="speed-error-perc">N/A</span>
            </div>
            <div class="data-point">
                <span class="label">Facteur Kalman Env.</span>
                <span id="env-factor">NORMAL</span> 
            </div>
            
            <hr style="border-top: 1px dashed #4a4a4a;">
            
            <div class="data-point">
                <span>Niveau √† Bulle (Pitch/Roll)</span><span id="bubble-level">-- ¬∞ / -- ¬∞</span>
            </div>
            <div class="data-point">
                <span>Luminosit√© (Ambient Light)</span><span id="luminosity">N/A lux</span>
            </div>
            <div class="data-point">
                <span>Niveau Sonore (Microphone)</span><span id="noise-level">N/A dB</span>
            </div>
            <div class="data-point">
                <span>Champ Magn√©tique</span><span id="magnetic-field">N/A ¬µT</span>
            </div>
            
            <hr style="border-top: 1px dashed #4a4a4a;">
            
            <div class="data-point">
                <span>Temp√©rature Air (API)</span><span id="temp-air">N/A</span>
            </div>
            <div class="data-point">
                <span>Pression Atmosph√©rique (API)</span><span id="pressure">N/A</span>
            </div>
            <div class="data-point">
                <span>Humidit√© Relative (API)</span><span id="humidity">N/A</span>
            </div>
            <div class="data-point">
                <span>Vitesse du Vent (Est.)</span><span id="wind-speed-est">N/A</span>
            </div>
            <div class="data-point">
                <span>Point d'√âbullition Eau (Est.)</span><span id="boiling-point-est">N/A</span>
            </div>
        </div>

        <section class="widget astro-moon">
            <h3>üåô Lune (SunCalc)</h3>
            <div class="data-point">
                <span class="label">Phase Lunaire (Fraction)</span>
                <span id="lunar-phase-perc">-- %</span>
            </div>
            <div class="data-point">
                <span class="label">√âl√©vation Lunaire</span>
                <span id="moon-elevation">-- ¬∞</span>
            </div>
            <div class="data-point">
                <span class="label">Azimut Lunaire</span>
                <span id="moon-azimuth">-- ¬∞</span>
            </div>
            <div class="data-point">
                <span class="label">Lever / Coucher Lune</span>
                <span id="moon-times">‚Üë --:-- / ‚Üì --:--</span>
            </div>
        </section>

    </main>

</body>
    </html>
