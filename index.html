<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GNSS SpaceTime Dashboard • UKF 21 États Fusion (COMPLET/HORS LIGNE)</title>
    
    <link rel="stylesheet" href="leaflet.css" />
    <link rel="stylesheet" href="fontawesome.min.css" />
          
    <style>
        /* --- Styles CSS Complets (Thème Sombre Professionnel) --- */
        :root {
            --bg-dark: #121220; --panel-dark: #1e1e1e; --text-dark: #e0e0e0;
            --border-dark: #333; --accent-color: #007bff; --error-color: #dc3545;
        }
        body { 
            font-family: 'Arial', sans-serif; margin: 0; padding: 0; 
            background-color: var(--bg-dark); color: var(--text-dark); 
            transition: background-color 0.3s, color 0.3s; 
        }
        .dashboard-container { 
            display: grid; 
            grid-template-columns: 1fr 1.5fr 1fr; 
            gap: 15px; padding: 15px; max-width: 1800px; margin: auto;
        }
        
        @media (max-width: 1200px) {
            .dashboard-container { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 800px) {
            .dashboard-container { grid-template-columns: 1fr; }
        }

        .panel {
            background-color: var(--panel-dark); padding: 15px; 
            border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); 
            border: 1px solid var(--border-dark);
        }
        .panel h2, .panel h3 {
            color: var(--accent-color); border-bottom: 2px solid var(--border-dark); 
            padding-bottom: 10px; margin-top: 0; margin-bottom: 15px;
            font-size: 1.2em;
        }
        .data-point {
            display: flex; justify-content: space-between; 
            padding: 8px 0; border-bottom: 1px dotted var(--border-dark);
            font-size: 0.95em;
        }
        .data-point span:first-child { 
            font-weight: 300; 
        }
        .data-point span:last-child {
            font-weight: bold; color: var(--text-dark); 
            text-align: right;
        }
        .status-light {
            width: 10px; height: 10px; border-radius: 50%; 
            display: inline-block; margin-right: 8px;
            background-color: var(--error-color);
        }
        .status-light.active {
            background-color: #28a745;
        }
        .map-container { 
            height: 400px; border-radius: 6px; overflow: hidden; 
            margin-bottom: 15px; border: 1px solid var(--border-dark);
        }
        .controls-group {
            display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;
        }
        .btn {
            background-color: var(--accent-color); color: white; border: none; 
            padding: 10px 15px; border-radius: 5px; cursor: pointer; 
            transition: background-color 0.2s; font-size: 0.9em;
        }
        .btn:hover { background-color: #0056b3; }
        .btn.error { background-color: var(--error-color); }
        .btn.error:hover { background-color: #c82333; }

        /* Styles spécifiques pour le tableau scientifique */
        .scientific-table {
            display: flex; flex-direction: column;
            gap: 15px;
        }
        .data-block {
            padding: 10px; border: 1px solid #444; border-radius: 5px;
        }
        .data-block h3 {
            margin: 0 0 10px 0; color: #ffc107; font-size: 1.1em;
        }
        .data-point span:last-child {
            font-family: 'Consolas', monospace; /* Police professionnelle pour les valeurs */
            color: #28a745; /* Vert pour les données actives */
        }
        .data-point .error-val {
            color: var(--error-color); /* Rouge pour les erreurs/NA */
        }
        
    </style>
</head>
<body>

    <main class="dashboard-container">
        
        <section class="panel control-panel">
            <h2><i class="fas fa-satellite-dish"></i> Contrôle & UKF État</h2>
            <div class="controls-group">
                <button id="start-btn" class="btn"><i class="fas fa-play"></i> Démarrer GPS</button>
                <button id="stop-btn" class="btn error"><i class="fas fa-stop"></i> Arrêter GPS</button>
                <button id="toggle-gps-btn" class="btn"><i class="fas fa-pause"></i> Pause GPS</button>
                <button id="reset-all-btn" class="btn">Réinitialiser Tout</button>
            </div>
            <div class="controls-group">
                <button id="reset-max-btn" class="btn">Reset Max</button>
                <button id="set-target-btn" class="btn"><i class="fas fa-bullseye"></i> Définir Cible</button>
                <button id="set-mass-btn" class="btn"><i class="fas fa-weight-hanging"></i> Masse/Traction</button>
                <button id="recharge-internet-btn" class="btn"><i class="fas fa-sync"></i> Recharger Données</button>
                <button id="nether-toggle-btn" class="btn"><i class="fas fa-globe"></i> Mode Nether</button>
            </div>
            
            <hr>
            <h3><i class="fas fa-info-circle"></i> État du Système</h3>
            <div class="data-point"><span>Statut GPS</span><span id="gps-status"><span class="status-light"></span> INACTIF</span></div>
            <div class="data-point"><span>Mode UKF</span><span id="ukf-mode">INACTIF</span></div>
            <div class="data-point"><span>Précision Actuelle</span><span id="current-precision">N/A</span></div>
            <div class="data-point"><span>Délai (Fast Loop)</span><span id="fast-loop-time">0 ms</span></div>
            <div class="data-point"><span>Délai (Slow Loop)</span><span id="slow-loop-time">0 ms</span></div>
            <div class="data-point"><span>Horloge Locale (NTP)</span><span id="local-time">Synchronisation...</span></div>
            
            <hr>
            <h3><i class="fas fa-filter"></i> UKF Paramètres</h3>
            <div class="data-point"><span>Réactivité UKF</span>
                <select id="ukf-reactivity-mode">
                    <option value="LOW">Basse (Stable)</option>
                    <option value="MEDIUM">Moyenne (Par défaut)</option>
                    <option value="HIGH">Haute (Réactif)</option>
                </select>
            </div>
            <div class="data-point"><span>Mode d'estimation</span>
                <select id="estimation-mode">
                    <option value="NORMAL">Normal (GPS+IMU)</option>
                    <option value="IMU_ONLY">IMU Seul</option>
                    <option value="GPS_ONLY">GPS Seul</option>
                </select>
            </div>
        </section>

        <section class="panel main-panel">
            <h2><i class="fas fa-map-marked-alt"></i> Géolocalisation & Cinématique</h2>
            <div id="map" class="map-container"></div>
            
            <div class="scientific-table">
                <div class="data-block">
                    <h3><i class="fas fa-tachometer-alt"></i> Vitesse & Accélération</h3>
                    <div class="data-point"><span>Vitesse Corrigée (3D)</span><span id="speed-corrected">0.00 km/h</span></div>
                    <div class="data-point"><span>Vitesse Max Corrigée</span><span id="speed-max">0.00 km/h</span></div>
                    <div class="data-point"><span>Accélération (Corrigée)</span><span id="accel-magnitude">0.00 m/s²</span></div>
                    <div class="data-point"><span>Jerk (Corrigé)</span><span id="jerk-magnitude">0.00 m/s³</span></div>
                    <div class="data-point"><span>Facteur de Lorentz (γ)</span><span id="lorentz-factor">1.0000e+0</span></div>
                </div>

                <div class="data-block">
                    <h3><i class="fas fa-globe-europe"></i> Position Géodésique</h3>
                    <div class="data-point"><span>Latitude (UKF)</span><span id="lat-ukf">N/A</span></div>
                    <div class="data-point"><span>Longitude (UKF)</span><span id="lon-ukf">N/A</span></div>
                    <div class="data-point"><span>Altitude Corrigée (UKF)</span><span id="alt-ukf">N/A</span></div>
                    <div class="data-point"><span>Rayon Terre (WGS84)</span><span id="earth-radius">N/A</span></div>
                    <div class="data-point"><span>Distance Parcourue (UKF)</span><span id="distance-traveled">0.00 m</span></div>
                </div>

                <div class="data-block">
                    <h3><i class="fas fa-cloud"></i> Altitude Barométrique</h3>
                    <div class="data-point"><span>Altitude Corrigée (Baro)</span><span id="alt-corrected-baro">N/A</span></div>
                    <div class="data-point"><span>Pression Mesurée</span><span id="pressure-baro">N/A</span></div>
                    <div class="data-point"><span>Vitesse Verticale (Corrigée)</span><span id="vertical-speed">0.00 m/s</span></div>
                </div>
            </div>
        </section>

        <section class="panel secondary-panel">
            <h2><i class="fas fa-flask"></i> Physique & Environnement</h2>
            
            <section class="data-block">
                <h3><i class="fas fa-rocket"></i> Aérodynamique & Gravité</h3>
                <div class="data-point"><span>Vitesse du Son</span><span id="speed-of-sound-calc">343.00 m/s</span></div>
                <div class="data-point"><span>Densité de l'Air (ρ)</span><span id="air-density">1.225 kg/m³</span></div>
                <div class="data-point"><span>Nombre de Mach</span><span id="mach-number">0.000</span></div>
                <div class="data-point"><span>Force de Traînée (Approximation)</span><span id="drag-force">0.00 N</span></div>
                <div class="data-point"><span>Gravité à l'Altitude (g)</span><span id="gravity-base">9.8066 m/s²</span></div>
                <div class="data-point"><span>Facteur Environnement</span><span id="env-factor">Standard (x1.0)</span></div>
            </section>
            
            <section class="data-block">
                <h3><i class="fas fa-temperature-three-quarters"></i> Météo/Polluants</h3>
                <div class="data-point"><span>Statut Météo</span><span id="weather-status">INACTIF</span></div>
                <div class="data-point"><span>Température (Air)</span><span id="temp-air-2">N/A</span></div>
                <div class="data-point"><span>Pression (Mer)</span><span id="pressure-2">N/A</span></div>
                <div class="data-point"><span>Humidité</span><span id="humidity-2">N/A</span></div>
                <div class="data-point"><span>Point de Rosée</span><span id="dew-point">N/A</span></div>
                <div class="data-point"><span>Indice Polluants (AQI)</span><span id="aqi-display">N/A</span></div>
            </section>

            <section class="data-block">
                <h3><i class="fas fa-calendar-alt"></i> Temps & Astronomie</h3>
                <div class="data-point"><span>Date</span><span id="date-display">N/A</span></div>
                <hr>
                <h3><i class="fas fa-sun"></i> Soleil</h3>
                <div class="data-point"><span>Altitude (Soleil)</span><span id="sun-alt">N/A</span></div>
                <div class="data-point"><span>Azimut (Soleil)</span><span id="sun-azimuth">N/A</span></div>
                <div class="data-point"><span>Durée du Jour</span><span id="day-duration">N/A</span></div>
                <div class="data-point"><span>Lever (TSM/TST)</span><span id="sunrise-times">N/A</span></div>
                <div class="data-point"><span>Coucher (TSM/TST)</span><span id="sunset-times">N/A</span></div>
                <hr>
                <h3><i class="fas fa-moon"></i> Lune</h3>
                <div class="data-point"><span>Phase</span><span id="moon-phase-name">N/A</span></div>
                <div class="data-point"><span>Illumination</span><span id="moon-illuminated">N/A</span></div>
                <div class="data-point"><span>Altitude (Lune)</span><span id="moon-alt">N/A</span></div>
                <div class="data-point"><span>Azimut (Lune)</span><span id="moon-azimuth">N/A</span></div>
                <div class="data-point"><span>Lever/Coucher Lune</span><span id="moon-times">N/A</span></div>
            </section>
        </section>
    </main>
    
    <script src="math.min.js"></script> 
    <script src="leaflet.js"></script>
    <script src="suncalc.js"></script>
    <script src="turf.min.js"></script>
    <script src="gnss-dashboard-full.js"></script>
</body>
                </html>
