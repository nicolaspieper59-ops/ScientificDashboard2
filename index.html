<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GNSS SpaceTime Dashboard - UKF 21 √âtats</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIINfBG5lAHpG3aeXyCo9BfM6icR/mlw6nw="
        crossorigin=""/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* CSS de base pour le mode sombre par d√©faut */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #121212;
            color: #e0e0e0;
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }
        body:not(.dark-mode) {
            background-color: #f0f0f0;
            color: #333;
        }
        h2 {
            border-bottom: 2px solid #333;
            padding-bottom: 5px;
            margin-top: 20px;
            color: #4a90e2;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 1400px;
            margin: auto;
        }
        .data-box, .control-panel, #map {
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        body:not(.dark-mode) .data-box, body:not(.dark-mode) .control-panel {
             background-color: #ffffff;
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dotted #333;
            font-size: 0.9em;
        }
        .data-label {
            font-weight: 300;
        }
        .data-value {
            font-weight: 500;
            text-align: right;
            color: #66ccff;
        }
        .status-header {
            font-size: 1.2em;
            margin-top: 5px;
            font-weight: bold;
            text-align: center;
            padding: 8px;
            border-radius: 4px;
            background-color: #2c2c2c;
            color: #fff;
        }
        .control-row {
            margin-bottom: 10px;
            display: flex;
            gap: 5px;
        }
        .action-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            flex-grow: 1;
        }
        #map {
            height: 400px;
            grid-column: 2 / span 2;
        }
        select, input[type="number"] {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #555;
            background-color: #333;
            color: #e0e0e0;
            width: 100%;
        }
    </style>
</head>

<body class="dark-mode">

    <header style="text-align: center; margin-bottom: 20px;">
        <h1 style="color: #4a90e2;">GNSS SpaceTime Dashboard</h1>
        <p>UKF 21 √âtats & R√©activit√© Adaptative</p>
    </header>

    <div class="dashboard-grid">
        
        <div class="control-panel">
            <h2>Contr√¥les & Syst√®me</h2>

            <div class="data-row"><span class="data-label">Heure Locale (NTP)</span><span class="data-value" id="local-time">En attente...</span></div>
            <div class="data-row"><span class="data-label">Date & Heure (Local)</span><span class="data-value" id="date-display">En attente...</span></div>
            <div class="data-row"><span class="data-label">Temps √©coul√© (Session)</span><span class="data-value" id="elapsed-time">0.00 s</span></div>
            <div class="data-row"><span class="data-label">Temps de Mouvement</span><span class="data-value" id="time-moving">0.00 s</span></div>
            <div class="data-row"><span class="data-label">Heure Minecraft</span><span class="data-value" id="time-minecraft">00:00</span></div>
            
            <hr style="border-color: #333; margin: 10px 0;">

            <div class="control-row">
                <button class="action-btn" id="toggle-gps-btn" style="background-color: #ffc107;">‚è∏Ô∏è PAUSE GPS</button>
                <select id="freq-select" style="flex-grow: 0.5;">
                    <option value="HIGH_FREQ">Haute Fr√©quence</option>
                    <option value="LOW_FREQ">Basse Fr√©quence</option>
                </select>
            </div>
            
            <div class="control-row">
                <button class="action-btn" id="emergency-stop-btn" style="background-color: #dc3545;">üõë Arr√™t d'urgence: INACTIF üü¢</button>
            </div>

            <div class="control-row">
                <button class="action-btn" id="toggle-sim-btn" style="background-color: #007bff; color: white;">
                    ‚ñ∂Ô∏è D√âMARRER SIMULATION IMU
                </button>
            </div>

            <div class="control-row">
                <button class="action-btn" id="toggle-mode-btn" style="background-color: #6c757d;"><i class="fas fa-sun"></i> Mode Jour</button>
            </div>

            <div class="control-row">
                <input type="number" id="gps-acc-override" value="0" placeholder="Forcer Pr√©cision GPS (m)">
            </div>

            <h2>Configuration UKF</h2>
            <div class="data-row"><span class="data-label">R√©activit√© UKF</span><span class="data-value" id="ukf-reactivity-factor">Automatique (x1.0)</span></div>
            <div class="control-row">
                <select id="ukf-reactivity-mode">
                    <option value="AUTO">AUTO (Adaptative)</option>
                    <option value="NORMAL">Normal</option>
                    <option value="FAST">Rapide (Tr√®s r√©actif)</option>
                    <option value="STABLE">Stable (Lissage Max)</option>
                </select>
            </div>

            <h2>Facteurs Environnementaux</h2>
            <div class="control-row">
                <select id="environment-select">
                    <option value="NORMAL">Normal (x1.0)</option>
                    <option value="FOREST">For√™t (x2.5)</option>
                    <option value="METAL">M√©tal/B√¢timent (x5.0)</option>
                    <option value="CONCRETE">Grotte/Tunnel (x7.0)</option>
                </select>
            </div>
            
            <h2>Param√®tres Physiques</h2>
            <div class="data-row"><span class="data-label">Masse de l'objet (kg)</span><span class="data-value" id="mass-value">70.000 kg</span></div>
            <input type="number" id="mass-input" value="70" style="margin-bottom: 10px;">
            
            <div class="data-row"><span class="data-label">Corps C√©leste (Gravit√©)</span><span class="data-value" id="gravity-value">9.8067 m/s¬≤</span></div>
            <div class="control-row">
                <select id="celestial-body-select">
                    <option value="EARTH">Terre</option>
                    <option value="MOON">Lune</option>
                    <option value="MARS">Mars</option>
                </select>
            </div>
            <div class="data-row"><span class="data-label">Rapport Distance (MRF)</span><span class="data-value" id="distance-ratio">1.000</span></div>
            
            <h2>Filtre UKF & Debug</h2>
            <div class="data-row"><span class="data-label">Variance Vitesse (P)</span><span class="data-value" id="variance-speed">0.000 m¬≤/s¬≤ (P)</span></div>
            <div class="data-row"><span class="data-label">Incertitude Alt. (œÉ)</span><span class="data-value" id="alt-uncertainty">0.000 m (œÉ)</span></div>
            <div class="data-row"><span class="data-label">Bruit Mesure Vitesse (R)</span><span class="data-value" id="kalman-r">0.000 m¬≤ (R dyn)</span></div>
        </div>

        <div>
            <div class="data-box">
                <h2>Vitesse & Distance (UKF)</h2>
                <div class="status-header" id="speed-status-text">Attente du signal GPS...</div>
                
                <p style="font-size: 3em; font-weight: bold; text-align: center; color: #00ff99; margin: 10px 0;"><span id="speed-stable">0.00</span> km/h</p>

                <div class="data-row"><span class="data-label">Vitesse Stable (m/s)</span><span class="data-value" id="speed-stable-ms">0.000 m/s</span></div>
                <div class="data-row"><span class="data-label">Vitesse Stable (km/s)</span><span class="data-value" id="speed-stable-kms">0.00e+0 km/s</span></div>
                
                <hr style="border-color: #333; margin: 10px 0;">

                <div class="data-row"><span class="data-label">Vitesse 3D (Instantan√©e)</span><span class="data-value" id="speed-3d-inst">0.00 km/h</span></div>
                <div class="data-row"><span class="data-label">Vitesse Brute (m/s)</span><span class="data-value" id="speed-raw-ms">0.000 m/s</span></div>
                <div class="data-row"><span class="data-label">Vitesse Max (Session)</span><span class="data-value" id="speed-max">0.00 km/h</span></div>
                <div class="data-row"><span class="data-label">Vitesse Moyenne (Mvt)</span><span class="data-value" id="speed-avg-moving">0.00 km/h</span></div>
                <div class="data-row"><span class="data-label">Vitesse Moyenne (Totale)</span><span class="data-value" id="speed-avg-total">0.00 km/h</span></div>
                
                <hr style="border-color: #333; margin: 10px 0;">

                <div class="data-row"><span class="data-label">Distance Totale (3D)</span><span class="data-value" id="distance-total-km">0.000 km | 0.00 m</span></div>
                <div class="data-row"><span class="data-label">Facteur de Lorentz (Œ≥)</span><span class="data-value" id="lorentz-factor">1.00000000</span></div>
            </div>

            <div class="data-box" style="margin-top: 20px;">
                <h2>IMU (Acc√©l√©rom√®tre/Magn√©tom√®tre)</h2>
                <div class="status-header" id="imu-status">En attente...</div>

                <div class="data-row"><span class="data-label">Acc√©l√©ration X (Long.)</span><span class="data-value" id="accel-x">0.00 m/s¬≤</span></div>
                <div class="data-row"><span class="data-label">Acc√©l√©ration Y (Lat.)</span><span class="data-value" id="accel-y">0.00 m/s¬≤</span></div>
                <div class="data-row"><span class="data-label">Acc√©l√©ration Z (Vert.)</span><span class="data-value" id="accel-z">0.00 m/s¬≤</span></div>
                
                <hr style="border-color: #333; margin: 10px 0;">
                
                <h2>Dynamique & Forces</h2>
                <div class="data-row"><span class="data-label">Gravit√© Locale (g)</span><span class="data-value" id="g-local">9.8067 m/s¬≤</span></div>
                <div class="data-row"><span class="data-label">Acc√©l√©ration Long. (Brute)</span><span class="data-value" id="accel-long">0.000 m/s¬≤</span></div>
                <div class="data-row"><span class="data-label">Vitesse Angulaire</span><span class="data-value" id="angular-speed">0.00 ¬∞/s</span></div>
                <div class="data-row"><span class="data-label">Pression Dynamique (q)</span><span class="data-value" id="dynamic-pressure">0.00 Pa</span></div>
            </div>
        </div>

        <div>
            <div class="data-box">
                <h2>Position & Astro</h2>
                <div class="data-row"><span class="data-label">Pr√©cision GPS (Acc)</span><span class="data-value" id="gps-precision">En attente...</span></div>
                <div class="data-row"><span class="data-label">Latitude (UKF)</span><span class="data-value" id="lat-ukf">0.000000 ¬∞</span></div>
                <div class="data-row"><span class="data-label">Longitude (UKF)</span><span class="data-value" id="lon-ukf">0.000000 ¬∞</span></div>
                <div class="data-row"><span class="data-label">Altitude (UKF)</span><span class="data-value" id="alt-ukf">0.00 m</span></div>
                <div class="data-row"><span class="data-label">Cap (Direction)</span><span class="data-value" id="heading">0.0 ¬∞</span></div>

                <hr style="border-color: #333; margin: 10px 0;">

                <h3>Heures Solaires</h3>
                <div class="data-row"><span class="data-label">Date Solaire Vraie</span><span class="data-value" id="date-solar-true">En attente...</span></div>
                <div class="data-row"><span class="data-label">Heure Solaire Vraie (TST)</span><span class="data-value" id="tst">00:00:00</span></div>
                <div class="data-row"><span class="data-label">Midi Solaire Local (UTC)</span><span class="data-value" id="noon-solar">00:00:00</span></div>
                <div class="data-row"><span class="data-label">√âquation du Temps (EOT)</span><span class="data-value" id="eot">0.00 min</span></div>
                
                <h3>Astro</h3>
                <div class="data-row"><span class="data-label">Altitude (Soleil)</span><span class="data-value" id="sun-alt">0.00 ¬∞</span></div>
                <div class="data-row"><span class="data-label">Phase Lune</span><span class="data-value" id="moon-phase-name">Nouvelle Lune üåë</span></div>
                <div class="data-row"><span class="data-label">Illumination Lune</span><span class="data-value" id="moon-illuminated">0.0 %</span></div>
            </div>
            
            <div class="data-box" style="margin-top: 20px;">
                <h2>M√©t√©o & Conditions Locales</h2>
                <div class="status-header" id="weather-status">En attente...</div>

                <div class="data-row"><span class="data-label">Temp√©rature Air</span><span class="data-value" id="temp-air-2">0.0 ¬∞C</span></div>
                <div class="data-row"><span class="data-label">Pression Atmosph√©rique</span><span class="data-value" id="pressure-2">1013 hPa</span></div>
                <div class="data-row"><span class="data-label">Humidit√© Relative</span><span class="data-value" id="humidity-2">0 %</span></div>
                <div class="data-row"><span class="data-label">Point de Ros√©e</span><span class="data-value" id="dew-point">0.0 ¬∞C</span></div>
                <div class="data-row"><span class="data-label">Densit√© de l'Air (œÅ)</span><span class="data-value" id="air-density">1.225 kg/m¬≥</span></div>
                
                <hr style="border-color: #333; margin: 10px 0;">

                <div class="data-row"><span class="data-label">Vitesse du Son Locale</span><span class="data-value" id="speed-of-sound">343.00 m/s</span></div>
                <div class="data-row"><span class="data-label">Nombre de Mach</span><span class="data-value" id="mach-number">0.0000</span></div>
            </div>
        </div>

        <div id="map" class="data-box" style="grid-column: 1 / 4;">
            Chargement de la carte...
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20n6aJ6PML3mI3W7N3N5K5S8fB3B5fB5K5J8B5J5L5J="
        crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.0.0/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/suncalc@1.8.0/suncalc.js"></script>
    
    <script src="gnss-dashbord-full.js"></script> 
</body>
                        </html>
